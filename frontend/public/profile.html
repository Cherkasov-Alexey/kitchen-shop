<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Личный кабинет — SmartCook</title>
    <link rel="stylesheet" href="css/style.css?v=25">
    <link rel="stylesheet" href="css/profile.css">
</head>
<body>

<header class="header">
    <div class="header-left">
        <div class="logo-block">
            <img src="images/logotip.png" alt="SmartCook logo" class="logo-img">
            <div class="logo-text">SmartCook</div>
        </div>

        <nav class="nav">
            <a href="index.html">Главная</a>
            <a href="catalog.html">Каталог товаров</a>
            <a href="sales.html">Акции</a>
            <a href="favorites.html">Избранное</a>
            
        </nav>
    </div>

    <div class="header-right">
        <div class="auth-actions user">
            <a href="profile.html" class="auth-btn" id="profile-name">Профиль</a>
            <a href="#" class="auth-btn logout">Выйти</a>
        </div>
        
        <a href="cart.html" class="cart-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 20C19 21.11 18.11 22 17 22C15.89 22 15 21.1 15 20C15 18.89 15.89 18 17 18C18.11 18 19 18.9 19 20M7 18C5.89 18 5 18.89 5 20C5 21.1 5.89 22 7 22C8.11 22 9 21.11 9 20S8.11 18 7 18M7.2 14.63L7.17 14.75C7.17 14.89 7.28 15 7.42 15H19V17H7C5.89 17 5 16.1 5 15C5 14.65 5.09 14.32 5.24 14.04L6.6 11.59L3 4H1V2H4.27L5.21 4H20C20.55 4 21 4.45 21 5C21 5.17 20.95 5.34 20.88 5.5L17.3 11.97C16.96 12.58 16.3 13 15.55 13H8.1L7.2 14.63M8.5 11H10V9H7.56L8.5 11M11 9V11H14V9H11M14 8V6H11V8H14M17.11 9H15V11H16L17.11 9M18.78 6H15V8H17.67L18.78 6M6.14 6L7.08 8H10V6H6.14Z"/>
            </svg>
            <span id="cart-count" class="cart-count" style="display: none;">0</span>
        </a>
    </div>
</header>

<main class="profile-container">
    <h1>Личный кабинет</h1>

    <div class="profile-card">
        <p><strong>Имя:</strong> <span id="user-name">Загрузка...</span></p>
        <p><strong>Email:</strong> <span id="user-email">Загрузка...</span></p>
        <p><strong>Дата регистрации:</strong> <span id="user-reg-date">Загрузка...</span></p>

        <button class="logout-btn" id="logout-btn">Выйти</button>
    </div>

    <div class="orders-section">
        <h2>История заказов</h2>
        <div id="orders-container">
            <p class="loading-text">Загрузка заказов...</p>
        </div>
    </div>
</main>

<footer class="footer">
    <div class="footer-content">
        <div class="footer-brand">
            <h3>SmartCook</h3>
            <p>Лучшая техника для современной кухни</p>
        </div>

        <div class="footer-links">
            <h4>Помощь</h4>
            <a href="help.html#delivery">Доставка и оплата</a>
            <a href="help.html#warranty">Гарантия и возврат</a>
            <a href="help.html#reviews">Отзывы</a>
        </div>

        <div class="footer-links">
            <h4>Категории</h4>
            <a href="catalog.html?category=2">Кофемашины</a>
            <a href="catalog.html?category=1">Холодильники</a>
            <a href="catalog.html?category=3">Посудомоечные машины</a>
        </div>

        <div class="footer-contacts">
            <h4>Контакты</h4>
            <p>г. Санкт-Петербург, Вознесенский пр., д. 23</p>
            <p>+7 (931) 123-45-67</p>
            <p>info@smartcook.ru</p>
            <p>Пн-Пт: 10:00-20:00, Сб-Вс: 11:00-18:00</p>
        </div>
    </div>

    <p class="footer-copy">© 2025 SmartCook. Все права защищены.</p>
</footer>

<script src="js/config.js?v=16"></script>`n<script src="js/api-v14.js?v=17"></script>
<script src="js/cart.js?v=16"></script>
<script src="js/auth.js?v=16"></script>
<script src="js/main.js?v=16"></script>
<script>
// Динамическая загрузка данных пользователя
document.addEventListener('DOMContentLoaded', async function() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    
    if (currentUser) {
        // Заполняем данные
        document.getElementById('user-name').textContent = currentUser.user_name || 'Не указано';
        document.getElementById('user-email').textContent = currentUser.email || 'Не указано';
        
        // Форматируем дату регистрации
        if (currentUser.created_at) {
            const date = new Date(currentUser.created_at);
            const dateOnly = date.toISOString().split('T')[0];
            const [year, month, day] = dateOnly.split('-');
            const months = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];
            document.getElementById('user-reg-date').textContent = `${parseInt(day)} ${months[parseInt(month) - 1]} ${year} г.`;
        } else {
            document.getElementById('user-reg-date').textContent = 'Неизвестно';
        }
            
        // Обновляем имя в шапке
        const profileName = document.getElementById('profile-name');
        if (profileName) {
            profileName.textContent = currentUser.user_name;
        }

        // Загружаем историю заказов
        await loadOrderHistory(currentUser.id);
    } else {
        // Если пользователь не авторизован, перенаправляем на вход
        window.location.href = 'login.html';
    }
    
    // Обработка кнопки выхода
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        });
    }
});

// Функция загрузки истории заказов
async function loadOrderHistory(userId) {
    const container = document.getElementById('orders-container');
    
    try {
        const response = await fetch(`${API_BASE_URL}/orders/${userId}`);
        
        if (!response.ok) {
            throw new Error('Ошибка загрузки заказов');
        }
        
        const orders = await response.json();
        
        if (orders.length === 0) {
            container.innerHTML = '<p class="no-orders">У вас пока нет заказов</p>';
            return;
        }
        
        // Отображаем заказы
        container.innerHTML = orders.map(order => {
            const statusClass = getStatusClass(order.status);
            const statusText = getStatusText(order.status);
            
            // Форматируем дату заказа
            const match = order.created_at.match(/(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2})/);
            let formattedDate = 'Неизвестно';
            if (match) {
                const [, year, month, day, hours, minutes] = match;
                const months = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];
                const monthName = months[parseInt(month) - 1];
                formattedDate = `${parseInt(day)} ${monthName} ${year} г. в ${hours}:${minutes}`;
            }
            
            // Формируем список товаров
            const itemsList = order.items.map(item => `
                <div class="order-item">
                    <img src="${item.image_url || 'images/placeholder.jpg'}" alt="${item.product_name}">
                    <div class="order-item-info">
                        <p class="order-item-name">${item.product_name}</p>
                        <p class="order-item-quantity">${item.quantity} шт. × ${parseFloat(item.price).toFixed(2)} ₽</p>
                    </div>
                    <p class="order-item-total">${(item.quantity * parseFloat(item.price)).toFixed(2)} ₽</p>
                </div>
            `).join('');
            
            return `
                <div class="order-card">
                    <div class="order-header">
                        <div class="order-info">
                            <h3>Заказ #${order.id}</h3>
                            <p class="order-date">${formattedDate}</p>
                        </div>
                        <span class="order-status ${statusClass}">${statusText}</span>
                    </div>
                    
                    <div class="order-items">
                        ${itemsList}
                    </div>
                    
                    <div class="order-footer">
                        <p class="order-total">Итого: <strong>${parseFloat(order.total).toFixed(2)} ₽</strong></p>
                        <a href="order-success.html?id=${order.id}" class="order-detail-btn">Подробнее</a>
                    </div>
                </div>
            `;
        }).join('');
        
    } catch (error) {
        console.error('Ошибка загрузки истории заказов:', error);
        container.innerHTML = '<p class="error-text">Не удалось загрузить историю заказов</p>';
    }
}

// Функция определения класса статуса
function getStatusClass(status) {
    const statusMap = {
        'pending': 'status-pending',
        'processing': 'status-processing',
        'completed': 'status-completed',
        'cancelled': 'status-cancelled'
    };
    return statusMap[status] || 'status-pending';
}

// Функция определения текста статуса
function getStatusText(status) {
    const statusMap = {
        'pending': 'Ожидает оплаты',
        'processing': 'В обработке',
        'completed': 'Выполнен',
        'cancelled': 'Отменён'
    };
    return statusMap[status] || status;
}
</script>

</body>
</html>

